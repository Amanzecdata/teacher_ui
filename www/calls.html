<!DOCTYPE html>
<html lang="en">

<head>
  <title>Teacher Portal</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <!-- user.html JS, CSS start -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css" />
  <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
  <!-- user.html JS, CSS end -->

  <link rel="stylesheet" href="css/dashboard.css" />
  <link rel="stylesheet" href="css/sidebar.css" />
  <link rel="stylesheet" href="css/setting.css" />
  <link rel="stylesheet" href="css/sms.css" />
  <link rel="stylesheet" href="css/header.css" />
  <link rel="stylesheet" href="css/administration.css" />

  <script src="js/main.js"></script>
  <script src="js/web_api.js"></script>

  <style>
    .p-0 .container-fluid {
      padding-left: 0px !important;
      padding-right: 0px !important;
    }
  </style>

  <script>
    function myFunction() {
      var x = document.getElementById("myLinks");
      if (x.style.display === "block") {
        x.style.display = "none";
      } else {
        x.style.display = "block";
      }
    }
  </script>
</head>

<body>
  <div class="container-fluid p-0">
    <!-- Bootstrap row -->
    <div class="row" id="body-row">
      <div id="left-sidebar"></div>
      <div class="col p-0 content-div">
        <div id="page-header"></div>
        <div class="container my-2">
          <h2>
            <b>Calls</b>
          </h2>
          <section id="tabs" class="administration-tab">
            <div class="container">
              <div class="row">
                <div class="col-md-12">
                  <nav>
                    <div class="nav nav-tabs nav-fill mb-4" id="nav-tab" role="tablist">
                      <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home"
                        role="tab" aria-controls="nav-home" aria-selected="true">Inbound Calls</a>
                      <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab"
                        aria-controls="nav-profile" aria-selected="false">Outbound Calls</a>
                      <!-- <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact"
                                                    aria-selected="false">Project Tab 3</a> -->
                    </div>
                  </nav>
                  <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                      <div class="table-div">
                        <table id="inboundCall" class="table table-striped table-bordered" style="width: 100%">
                          <thead>
                            <tr>
                              <th>Date</th>
                              <th>From</th>
                              <th>To</th>
                              <th>Recording</th>
                            </tr>
                          </thead>
                          <tbody id="inbound-data"></tbody>
                        </table>
                        <div id="inboundCallsLoader" class="d-flex justify-content-center">
                          <svg style="height: auto; width: 120px;" version="1.1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="25 25 50 50">
                            <circle cx="50" cy="50" r="20" fill="none" stroke-width="5" stroke="#132644"
                              stroke-linecap="round" stroke-dashoffset="0" stroke-dasharray="100, 200">
                              <animateTransform attributeName="transform" attributeType="XML" type="rotate"
                                from="0 50 50" to="360 50 50" dur="2.5s" repeatCount="indefinite" />
                              <animate attributeName="stroke-dashoffset" values="0;-30;-124" dur="1.25s"
                                repeatCount="indefinite" />
                              <animate attributeName="stroke-dasharray" values="0,200;110,200;110,200" dur="1.25s"
                                repeatCount="indefinite" />
                            </circle>
                          </svg>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                      <div class="table-div">
                        <table id="outboundCall" class="table table-striped table-bordered" style="width: 100%">
                          <thead>
                            <tr>
                              <th>Date</th>
                              <th>From</th>
                              <th>To</th>
                              <th>Recording</th>
                            </tr>
                          </thead>
                          <tbody id="outbound-data"></tbody>
                        </table>
                        <div id="outboundCallsLoader" class="d-flex justify-content-center">
                          <svg style="height: auto; width: 120px;" version="1.1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="25 25 50 50">
                            <circle cx="50" cy="50" r="20" fill="none" stroke-width="5" stroke="#132644"
                              stroke-linecap="round" stroke-dashoffset="0" stroke-dasharray="100, 200">
                              <animateTransform attributeName="transform" attributeType="XML" type="rotate"
                                from="0 50 50" to="360 50 50" dur="2.5s" repeatCount="indefinite" />
                              <animate attributeName="stroke-dashoffset" values="0;-30;-124" dur="1.25s"
                                repeatCount="indefinite" />
                              <animate attributeName="stroke-dasharray" values="0,200;110,200;110,200" dur="1.25s"
                                repeatCount="indefinite" />
                            </circle>
                          </svg>
                        </div>
                      </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <script>
    var passwordResetToken = getParam("token");
    var userToken = localStorage.getItem("user-token");

    console.log("MODE: PASSWORD_RESET, Token - " + passwordResetToken);

    if (userToken == null) {
      window.location.replace("student_login.html");
    }

    function getParam(sParam) {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split("&");
      for (var i = 0; i < sURLVariables.length; i++) {
        var sParameterName = sURLVariables[i].split("=");
        if (sParameterName[0] == sParam) {
          return sParameterName[1];
        }
      }
    }

    $(document).ready(function () {
      $("#left-sidebar").load("sidebar.html");
      $("#page-header").load("header.html");
      //                        $("#page-container").load('dashboard.html');
    });
    $("#body-row .collapse").collapse("hide");

    // Collapse/Expand icon
    //$('#collapse-icon').addClass('fa-angle-double-left');

    // Collapse click
    function left_sidebar() {
      SidebarCollapse();
    }

    function SidebarCollapse() {
      $(".menu-collapsed").toggleClass("d-none");
      $(".sidebar-submenu").toggleClass("d-none");
      $(".submenu-icon").toggleClass("d-none");
      $("#sidebar-container").toggleClass(
        "sidebar-expanded sidebar-collapsed"
      );

      // Treating d-flex/d-none on separators with title
      var SeparatorTitle = $(".sidebar-separator-title");
      if (SeparatorTitle.hasClass("d-flex")) {
        SeparatorTitle.removeClass("d-flex");
      } else {
        SeparatorTitle.addClass("d-flex");
      }

      // Collapse/Expand icon
      //$('#collapse-icon').toggleClass('fa-angle-double-left fa-angle-double-right');
    }




    $(document).ready(function () {
      list_inbound_calls(function (response) {
        var users = JSON.parse(response)
        $('#inboundCallsLoader').remove();
        users.forEach((item) => {
          $("#inbound-data").append(`<tr>
                        <td>${item.fields.date}</td>
                        <td>${item.fields.from_number}</td>
                        <td>${item.fields.to_number}</td>
                        <td><audio controls >
                        <source src="${item.fields.recording_url}">
                        </audio></td>
                        </tr>`);
          $('#outboundCallsLoader').remove();
          $("#outbound-data").append(`<tr>
                        <td>${item.fields.date}</td>
                        <td>${item.fields.from_number}</td>
                        <td>${item.fields.to_number}</td>
                        <td><audio controls >
                        <source src="${item.fields.recording_url}">
                        </audio></td>
                        </tr>`);
        });
        
        $("#inboundCall").DataTable();
        $("#outboundCall").DataTable();
      });
    });

  </script>
</body>
</html>