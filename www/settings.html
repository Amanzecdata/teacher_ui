<!doctype html>
<html>

<head>
    <title>Lesson Settings</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
    <!-- user.html JS, CSS start -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css" />
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
    <!-- firebase -->
    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script>
    <!-- user.html JS, CSS end -->

    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/setting.css" />
    <link rel="stylesheet" href="css/sms.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/administration.css" />
    <link rel="stylesheet" href="css/student_list.css" />
    <link rel="stylesheet" href="css/lesson_list.css" />

    <script src="js/main.js"></script>
    <style>
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <div class="row" id="screen1">
            <!-- <div class="col-xs-6 col-sm-3">
                    <div class="common-style my-profile" id="my-profile">
                        <span class="glyphicon glyphicon-user"></span>
                        <p>My Profile</p>
                    </div>
                </div>
                <div class="col-xs-6 col-sm-3">
                    <div class="common-style my-meds" onclick="showDiv(this)" id="my-meds">
                        <i class="fas fa-capsules"></i>
                        <p>My Med</p>
                    </div>
                </div>
                <div class="col-xs-6 col-sm-3">
                    <div class="common-style gps-check" onclick="showDiv(this)" id="gps-check">
                        <span class="glyphicon glyphicon-map-marker"></span>
                        <p>GPS Journal</p>
                    </div>
                </div> -->
            <!-- <div class="col-xs-6 col-sm-3">
                    <div class="common-style gps-check" onclick="showDiv(this)" id="send-email">
                        <span class="glyphicon glyphicon-map-marker"></span>
                        <p>User Lesson Response Notify</p>
                    </div>
                </div> -->
            <!-- <div class="col-xs-6 col-sm-3">
                    <div class="common-style video-check">
                        <span class="glyphicon glyphicon-facetime-video"></span>
                        <p>Video Journal</p>
                    </div>
                </div>
                <div class="col-xs-6 col-sm-3">
                    <div class="common-style shelters" id="shelters">
                        <span class="glyphicon glyphicon-home"></span>
                        <p>Shelters</p>
                    </div>
                </div>
            </div> -->
            <div class="row" id="screen2" style="display: none">
                <div class="col-xs-12">
                    <h1> Profile</h1>
                    <div>
                        <div class="input-group name-input" style='display:none'>
                            <span class="input-group-addon">
                                <i class="fa fa-user" aria-hidden="true"></i>
                            </span>
                            <input id="name" type="text" class="form-control" name="name" placeholder="Name">
                        </div>
                        <br>
                        <div class="input-group phone-code-input" style='display:none;'>
                            <span class="input-group-addon">
                                <i class="fa" aria-hidden="true"></i>
                            </span>
                            <input id="phone-code" type="tel" class="form-control" name="phone-code"
                                placeholder="Text Code">
                        </div>
                        <div class="input-group phone-input">
                            <span class="input-group-addon">
                                <i class="fa fa-phone" aria-hidden="true"></i>
                            </span>
                            <input id="phone" type="tel" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}" class="form-control"
                                name="phone" placeholder="Phone Number">
                        </div>
                        <!--
                                <br>
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="fa fa-birthday-cake" aria-hidden="true"></i></span>
                                    <input id="phone" type="text" class="form-control" name="age" placeholder="Age">
                                </div>
                                <br>
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="fa fa-users" aria-hidden="true"></i></span>
                                    <input id="phone" type="text" class="form-control" name="ethnicity" placeholder="Ethnicity">
                                </div>-->
                        <br>
                        <button id="login_number" type="button" class="btn btn-primary btn-lg btn-block">Next</button>
                        <br>
                        <br>
                    </div>
                </div>
            </div>
            <div class="row" id="map-check" style="display: none">
                <div class="col-xs-12">
                    <h1> GPS Check-In</h1>
                    <textarea class="form-control" rows="10" name="note"> Note</textarea>
                    <br>
                    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
                </div>
            </div>
            <div class="row m-4" id="send-email-response" style="display: block">
                <div class="col-xs-12">
                    <h1>Lesson Settings</h1>
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="email-tab" data-toggle="tab" href="#email" role="tab"
                                aria-controls="email" aria-selected="true">Email Notification</a>
                        </li>
                        <li class="nav-item" onclick="fetchAllSlackNotifications()">
                            <a class="nav-link" id="slack-tab" data-toggle="tab" href="#slack" role="tab"
                                aria-controls="slack" aria-selected="false">Slack Notification</a>
                        </li>
                        <li class="nav-item" onclick="fetchLessonStyles()">
                            <a class="nav-link" id="styles-tab" data-toggle="tab" href="#styles" role="tab"
                                aria-controls="styles" aria-selected="false">Styles</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="analytics-tab" data-toggle="tab" href="#analytics" role="tab"
                                aria-controls="analytics" aria-selected="false">Analytics</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="email" role="tabpanel" aria-labelledby="email-tab">
                            <form class="mt-5" name="emailForm" onsubmit="submitEmailForm(event)">
                                <div style="margin-bottom: 1em;">
                                    <label for="email">Email</label>
                                    <a href="#" style="font-size: 17px; float: right;"
                                        onclick="fetchAllEmailNotifications(event)">
                                        <span class="glyphicon glyphicon-refresh"></span>
                                    </a>
                                </div>
                                <div id="emailForm_content">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <input style="width: 90%;" id="email" type="email" class="form-control"
                                                name="email" placeholder="abc@gmail.com" required>
                                            <a href="#" class="btn btn-primary ml-auto"
                                                onclick="addMoreEmailBox(event)">
                                                <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <br>
                                <button type="submit" onclick="" class="btn btn-primary ">Submit</button>
                                <button type="button" onclick="deleteMail(event);"
                                    class="btn btn-danger ">Delete</button>
                                <br>
                                <br>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="slack" role="tabpanel" aria-labelledby="slack-tab">
                            <form class="mt-5" name="slackForm" onsubmit="submitSlackForm(event)">
                                <div style="margin-bottom: 1em;">
                                    <label for="slack">Slack URL</label>
                                    <a href="#" style="font-size: 17px; float: right;"
                                        onclick="fetchAllSlackNotifications(event)">
                                        <span class="glyphicon glyphicon-refresh"></span>
                                    </a>
                                </div>

                                <div id="slackForm_content">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <input style="width: 90%;" id="slack_url" type="text" class="form-control"
                                                name="slack" placeholder="https://api.slack.com/...">
                                            <a href="#" class="btn btn-primary ml-auto"
                                                onclick="addMoreSlackBox(event)">
                                                <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <br>
                                <button type="submit" class="btn btn-primary ">Submit</button>
                                <button type="button" onclick="deleteSlackNotification(event)"
                                    class="btn btn-danger ">Delete</button>
                                <br>
                                <br>
                            </form>
                        </div>

                        <div class="tab-pane fade" id="styles" role="tabpanel" aria-labelledby="styles-tab">
                            <form class="mt-5" name="stylesForm" onsubmit="setLessonCSS(event)">
                                <div style="margin-bottom: 1em;">
                                    <label for="styles">Lesson CSS</label>
                                    <a href="#" style="font-size: 17px; float: right;"
                                        onclick="fetchLessonStyles(event)">
                                        <span class="glyphicon glyphicon-refresh"></span>
                                    </a>
                                </div>
                                <div id="styleForm_content">
                                    <div class="form-group">
                                        <div class="form-row">
                                            <textarea row="10" class="form-control" value="${response}" name="style" placeholder="h1 {color: red}..." required></textarea>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <br>
                                <button type="submit" onclick="" class="btn btn-primary ml-auto">Submit</button>
                                <br>
                                <br>
                            </form>
                        </div>

                        <div class="tab-pane fade" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
                            <canvas id="myChart" width="600" height="600"></canvas>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row" id="shelters-screen" style="display: none">
                <h3> Shelters </h3>
                Populate:
                <select id='filter_services'>
                    <option>adults</option>
                    <option>young adults</option>
                    <option>seniors</option>
                    <option>hiv/aids</option>
                </select> TOGGLE FOR MAP View (On / Off)
                <div class="col-xs-12" id='shelters-list'>
                </div>
            </div>
            <div class="row" id="shelters-map" style="display: none">
                <div id='map' style='width: 400px; height: 300px;'></div>
            </div>
        </div>
        <script type="text/javascript">
            var userToken = localStorage.getItem("user-token");
            function showDiv(obj) {
                var selctID = obj.id;
                if (selctID == 'gps-check') {
                    document.getElementById('screen1').style.display = "none";
                    document.getElementById('screen2').style.display = "none";
                    document.getElementById('shelters-screen').style.display = "none";
                    document.getElementById('send-email-response').style.display = "none";
                    document.getElementById('map-check').style.display = "block";
                }
                if (selctID == 'shelters') {
                    document.getElementById('screen1').style.display = "none";
                    document.getElementById('screen2').style.display = "none";
                    document.getElementById('map-check').style.display = "none";
                    document.getElementById('send-email-response').style.display = "none";
                    document.getElementById('shelters-screen').style.display = "block";
                }
                if (selctID == 'send-email') {
                    document.getElementById('screen1').style.display = "none";
                    document.getElementById('screen2').style.display = "none";
                    document.getElementById('map-check').style.display = "none";
                    document.getElementById('shelters-screen').style.display = "none";
                    document.getElementById('send-email-response').style.display = "block";
                }
            }
            function getParam(sParam) {
                var sPageURL = window.location.search.substring(1);
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++) {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] == sParam) {
                        return sParameterName[1];
                    }
                }
            }
            var lesson_id = getParam('lesson_id');
            if (lesson_id !== "undefined") {

                function submitEmailForm(event, type) {
                    event.preventDefault();
                    const formSerialized = $('form[name="emailForm"]').serializeArray();
                    const formVal = formSerialized.filter(el => el.name == 'email' && el.value).map(e => e.value);
                    console.log("🚀 ~ file: settings.html ~ line 194 ~ sendMail ~ email", { emails: formVal })
                    data = {
                        "emails": formVal
                    }
                    sendMail(data);
                }

                function submitSlackForm(event) {
                    event.preventDefault();
                    const formSerialized = $('form[name="slackForm"]').serializeArray();
                    const formVal = formSerialized.filter(el => el.name == 'slack' && el.value).map(e => e.value);
                    console.log("🚀 ~ file: settings.html ~ submitSlackForm ~ urls", { urls: formVal })
                    if (!formVal.length) return;
                    data = {
                        "urls": formVal
                    }
                    $.ajax({
                        url: SERVER + "lesson_notifications/lesson/add_notify/slack/" + lesson_id,
                        async: true,
                        crossDomain: true,
                        crossOrigin: true,
                        type: 'POST',
                        data: JSON.stringify(data),
                        headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' }
                    }).done((response) => {
                        console.log("🚀 ~ file: settings.html ~ line 202 ~ response", response)
                        $("#slackForm_content input").prop("disabled", true);
                        swal({
                            title: 'Submitted',
                            text: 'You have successfully register slack. Thank you.',
                            icon: 'success',
                            timer: 2000,
                        });
                    }).fail((err) => {
                        console.log("errorss...", err)
                        swal({
                            title: 'Fail',
                            text: 'You have not successfully register slack.',
                            icon: 'error',
                            timer: 2000,
                        });
                    })
                }

                function setLessonCSS(event) {
                    event.preventDefault();
                    const formSerialized = $('form[name="stylesForm"]').serializeArray();
                    const formVal = formSerialized[0].value;
                    data = {
                        "css": formVal
                    }
                    $.ajax({
                        url: SERVER + "courses_api/lesson/set_style/" + lesson_id,
                        async: true,
                        crossDomain: true,
                        crossOrigin: true,
                        type: 'POST',
                        data: JSON.stringify(data),
                        headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' }
                    }).done((response) => {
                        console.log("🚀 ~ file: settings.html ~ line 202 ~ response", response)
                        swal({
                            title: 'Submitted',
                            text: 'Lesson style updated.',
                            icon: 'success',
                            timer: 2000,
                        });
                    }).fail((err) => {
                        console.log("errorss...", err)
                        swal({
                            title: 'Fail',
                            text: 'Couldn\'t updated styles, try again!',
                            icon: 'error',
                            timer: 2000,
                        });
                    })
                }


                function sendMail(data) {
                    $(document).ready(function () {

                        $.ajax({
                            url: SERVER + "lesson_notifications/lesson/add_notify/" + lesson_id,
                            async: true,
                            crossDomain: true,
                            crossOrigin: true,
                            type: 'POST',
                            data: JSON.stringify(data),
                            headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' }
                        }).done((response) => {
                            console.log("🚀 ~ file: settings.html ~ line 202 ~ response", response)
                            $("#emailForm_content input").prop("disabled", true);
                            swal({
                                title: 'Submitted',
                                text: 'You have successfully register email. Thank you.',
                                icon: 'success',
                                timer: 2000,
                            });
                        }).fail((err) => {
                            console.log("errorss...", err)
                            swal({
                                title: 'Fail',
                                text: 'You have not successfully register email.',
                                icon: 'error',
                                timer: 2000,
                            });
                        })
                    });
                }
                function addMoreEmailBox(e) {
                    const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" id="email" type="email" class="form-control" name="email" placeholder="abc@gmail.com" required>
                                        <a href="#" class="btn btn-primary ml-auto" onclick="addMoreEmailBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>`
                    $("#emailForm_content").children().each((i, el) => {
                        const btn = $(el).first().children().find('a.btn')
                        btn.prop("onclick", null).off("click").on("click", removeEmailBox);
                        btn.find("span.glyphicon").removeClass("glyphicon-plus").addClass("glyphicon-minus");
                    })
                    $("#emailForm_content").append(formGroup);
                }


                function addMoreSlackBox(params) {
                    const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" id="slack_url" type="text" class="form-control" name="slack" placeholder="https://api.slack.com/...">
                                        <a href="#" class="btn btn-primary ml-auto" onclick="addMoreSlackBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>`
                    $("#slackForm_content").children().each((i, el) => {
                        const btn = $(el).first().children().find('a.btn')
                        btn.prop("onclick", null).off("click").on("click", removeEmailBox);
                        btn.find("span.glyphicon").removeClass("glyphicon-plus").addClass("glyphicon-minus");
                    })
                    $("#slackForm_content").append(formGroup);
                }

                function removeEmailBox(event) {
                    $(event.target).parents("div.form-group").remove("div");
                }

                function deleteMail(event) {
                    console.log(event);
                    event.preventDefault();
                    console.log("🚀 ~ file: settings.html ~ line 194 ~ sendMail ~ email", email);

                    // Find disabled inputs, and remove the "disabled" attribute
                    var disabled = $('form[name="emailForm"]').find(':input:disabled').removeAttr('disabled');
                    // re-disabled the set of inputs that you previously enabled
                    const formSerialized = $('form[name="emailForm"]').serializeArray();
                    const formVal = formSerialized.filter(el => el.name == 'email').map(e => e.value);
                    console.log("🚀 ~ file: settings.html ~ line 194 ~ sendMail ~ email", { emails: formVal })
                    disabled.attr('disabled', 'disabled');
                    data = {
                        "emails": formVal
                    }
                    $(document).ready(function () {

                        $.ajax({
                            url: SERVER + "lesson_notifications/lesson/remove_notify/" + lesson_id,
                            async: true,
                            crossDomain: true,
                            crossOrigin: true,
                            type: 'DELETE',
                            headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' },
                            data: JSON.stringify(data),
                        }).done((response) => {
                            console.log("🚀 ~ file: settings.html ~ line 202 ~ response", response)
                            const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" data-new="true" type="email" class="form-control" name="email" placeholder="abc@gmail.com" required>
                                        <a href="#" class="btn btn-primary ml-auto" onclick="addMoreEmailBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>`
                            $("#emailForm_content").empty();
                            $("#emailForm_content").append(formGroup);
                            swal({
                                title: 'Deleted',
                                text: 'You have successfully completed the lesson. Thank you.',
                                icon: 'success',
                                timer: 2000,
                            });
                        }).fail((err) => {
                            console.log("errorss...", err)
                            swal({
                                title: 'fail',
                                text: 'You have successfully completed the lesson. Thank you.',
                                icon: 'error',
                                timer: 2000,
                            });
                        })
                    });
                }

                function deleteSlackNotification(event) {
                    console.log(event);
                    event.preventDefault();
                    console.log("🚀 ~ file: settings.html ~ line 194 ~ sendMail ~ email", email);

                    // Find disabled inputs, and remove the "disabled" attribute
                    var disabled = $('form[name="slackForm"]').find(':input:disabled').removeAttr('disabled');
                    // re-disabled the set of inputs that you previously enabled
                    const formSerialized = $('form[name="slackForm"]').serializeArray();
                    const formVal = formSerialized.filter(el => el.name == 'slack').map(e => e.value);
                    console.log("🚀 ~ file: settings.html ~ deleteSlackNotification ~ url", { urls: formVal })
                    disabled.attr('disabled', 'disabled');
                    data = {
                        "urls": formVal
                    }
                    $(document).ready(function () {

                        $.ajax({
                            url: SERVER + "lesson_notifications/lesson/remove_notify/slack/" + lesson_id,
                            async: true,
                            crossDomain: true,
                            crossOrigin: true,
                            type: 'DELETE',
                            headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' },
                            data: JSON.stringify(data),
                        }).done((response) => {
                            console.log("🚀 ~ file: settings.html ~ line 471 ~ response", response)
                            const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" data-new="true" type="text" class="form-control" name="slack" placeholder="https://api.slack.com/..." required>
                                        <a class="btn btn-primary ml-auto" onclick="addMoreSlackBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>`
                            $("#slackForm_content").empty();
                            $("#slackForm_content").append(formGroup);
                            swal({
                                title: 'Deleted',
                                text: 'Successfully deleted the notifications.',
                                icon: 'success',
                                timer: 2000,
                            });
                        }).fail((err) => {
                            console.log("errorss...", err)
                            swal({
                                title: 'fail',
                                text: 'Unable to delete the notifications.',
                                icon: 'error',
                                timer: 2000,
                            });
                        })
                    });
                }
            }

            function fetchAllSlackNotifications(e) {
                if(window.slackLoading) return;
                window.slackLoading = true;
                $.ajax({
                    url: SERVER + "lesson_notifications/lesson/list_notify/slack/" + lesson_id,
                    async: true,
                    crossDomain: true,
                    crossOrigin: true,
                    type: 'GET',
                    headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' },
                }).done((response) => {
                    console.log("🚀 ~ file: settings.html ~ line 202 ~ response", response)
                    console.log(response)
                    let formGroups = [];
                    response.forEach(n => {
                        const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" data-id="${n.id}" type="text" class="form-control" value="${n.url}" name="slack" placeholder="https://api.slack.com/..." disabled>
                                        <a href="#" class="btn btn-primary ml-auto" onclick="removeEmailBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-minus"></span>
                                        </a>
                                    </div>
                                </div>`
                        formGroups.push(formGroup);
                    })
                    const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" data-new="true" type="text" class="form-control" name="slack" placeholder="https://api.slack.com/..." required>
                                        <a href="#" class="btn btn-primary ml-auto" onclick="addMoreSlackBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>`
                    formGroups.push(formGroup);
                    $("#slackForm_content").empty();
                    $("#slackForm_content").append(formGroups);
                }).fail((err) => {
                    console.log("errorss...", err)
                    swal({
                        title: 'fail',
                        text: 'Could not fetch your notifications.',
                        icon: 'error',
                        timer: 2000,
                    });
                }).always(()=>{
                    window.slackLoading = false;
                })
            };
            function fetchAllEmailNotifications() {
                if(window.emailLoading) return;
                window.emailLoading = true;
                $.ajax({
                    url: SERVER + "lesson_notifications/lesson/list_notify/" + lesson_id,
                    async: true,
                    crossDomain: true,
                    crossOrigin: true,
                    type: 'GET',
                    headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' },
                }).done((response) => {
                    console.log("🚀 ~ file: settings.html ~ line 202 ~ response", response)
                    console.log(response)
                    let formGroups = [];
                    response.forEach(n => {
                        const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" data-id="${n.id}" type="email" class="form-control" value="${n.email}" name="email" placeholder="abc@gmail.com" disabled>
                                        <a href="#" class="btn btn-primary ml-auto" onclick="removeEmailBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-minus"></span>
                                        </a>
                                    </div>
                                </div>`
                        formGroups.push(formGroup);
                    })
                    const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <input style="width: 90%;" data-new="true" type="email" class="form-control" name="email" placeholder="abc@gmail.com" required>
                                        <a href="#" class="btn btn-primary ml-auto" onclick="addMoreEmailBox(event)">
                                            <span style="font-size: 20px;" class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>`
                    formGroups.push(formGroup);
                    $("#emailForm_content").empty();
                    $("#emailForm_content").append(formGroups);
                }).fail((err) => {
                    console.log("errorss...", err)
                    swal({
                        title: 'fail',
                        text: 'Could not fetch your notifications.',
                        icon: 'error',
                        timer: 2000,
                    });
                }).always(()=>{
                    window.emailLoading = false;
                })
            }

            function fetchLessonStyles() {
                if(window.stylesLoading) return;
                window.stylesLoading = true;
                $.ajax({
                    url: SERVER + "courses_api/lesson/get_style/" + lesson_id,
                    async: true,
                    crossDomain: true,
                    crossOrigin: true,
                    type: 'GET',
                    headers: { "Authorization": `Token ${localStorage.getItem('user-token')}`, 'Content-Type': 'application/json' },
                }).done((response) => {
                    console.log(response)
                    let formGroups = [];
                    const formGroup = `<div class="form-group">
                                    <div class="form-row">
                                        <textarea row="10" class="form-control" value="${response.css}" name="style" placeholder="h1 {color: red}..." required></textarea>
                                    </div>
                                </div>`
                    formGroups.push(formGroup);
                    $("#emailForm_content").empty();
                    $("#emailForm_content").append(formGroups);
                }).fail((err) => {
                    console.log("errorss...", err)
                    swal({
                        title: 'fail',
                        text: 'Could not fetch your notifications.',
                        icon: 'error',
                        timer: 2000,
                    });
                }).always(()=>{
                    window.emailLoading = false;
                })
            }

            function displayChart(params) {
                ctx = document.getElementById('myChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Lesson 1', 'Lesson 2', 'Lesson 3', 'Lesson 4', 'Lesson 5', 'Lesson 6'],
                        datasets: [{
                            label: 'No of Submissions',
                            data: [12, 19, 3, 5, 2, 3],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 206, 86, 0.2)',
                                'rgba(75, 192, 192, 0.2)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 159, 64, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options:{
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            $(document).ready(function () {
                if (localStorage.getItem('user-token')) {
                    $(document).ready(fetchAllEmailNotifications());
                    displayChart();
                }
            });
        </script>
</body>

</html>