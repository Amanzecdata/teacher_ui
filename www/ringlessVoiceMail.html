<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Teacher Portal</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
            integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
            crossorigin="anonymous"
            />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
            />
        <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"
        ></script>

        <!-- user.html JS, CSS start -->
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css"
            />
        <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
        <!-- firebase -->
        <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script>

        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        
        <!-- Country flags and code -->
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />
          <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
        
        <!-- user.html JS, CSS end -->

        <link rel="stylesheet" href="css/dashboard.css" />
        <link rel="stylesheet" href="css/sidebar.css" />
        <link rel="stylesheet" href="css/setting.css" />
        <link rel="stylesheet" href="css/sms.css" />
        <link rel="stylesheet" href="css/header.css" />
        <link rel="stylesheet" href="css/administration.css" />

        <script src="js/main.js"></script>
        <script src="js/web_api.js"></script>
        <script src="js/recorder.js"></script>
       

        <style>
            .p-0 .container-fluid {
                padding-left: 0px !important;
                padding-right: 0px !important;
            }
            .contacts-box {
                height:800px;
            }
            .message-datatable .row{
                margin-right:0px!important;
                margin-left:0px!important;
                
            }
            .user-box{
                margin-bottom:15px;
            }
            .d-dflex .iti {
                display:flex!important;
            }
            #filter-message{
                text-align: right!important;
                padding-right: 43px!important;
            }
            #select-filter{
                margin-left: 870px;
            }
        </style>

        <script>
            function myFunction() {
                var x = document.getElementById("myLinks");
                if (x.style.display === "block") {
                    x.style.display = "none";
                } else {
                    x.style.display = "block";
                }
            }
        </script>
    </head>
    <body>
        <div class="container-fluid p-0">
            <div class="row">
                <div class="col-md-12" style=" text-align: center;
                background: transparent;
                position: fixed;
                z-index: 1000;
                top: 100px;
                left: 0;
                height: 100%;
                width: 100%;
                display: none;">
                    <img id="loading-image" src="img/loader.webp" alt="">

                </div>

            </div>
            <!-- Bootstrap row -->
            <div class="row" id="body-row">
                <div id="left-sidebar"></div>
                <div class="col pl-0 content-div">
                    <div id="page-header"></div>
                    <div class="container-fluid">
                        <div class="">
                            <div class="row m-0">
                                <div
                                    class="col-md-12 col-sm-12 col-lg-12 col-12 d-none d-lg-block contacts-box"
                                    id="contacts-box"
                                    >
                                    <div class="col-lg-12 col-sm-12 col-md-12 col-12 user-box">
                                        <div class="row conversation-header">
                                            <div class="col-md-6 col-6">
                                                <p class="font-20"> Ringless Voice Mails</p>
                                            </div>
                                            <!-- <div class="col-md-4 col-4">
                                                <button type="button" data-toggle="modal" data-target="#userModal"
                                                    class="btn btn-primary">
                                                     Send Ringless Voice Mail
                                                </button>
                                            </div> -->
                                            <div class="col-md-6 col-6">
                                                <button type="button" data-toggle="modal" data-target="#recordRinglessVoiceMailModal"
                                                    class="btn btn-primary">
                                                    Record Voice Mail
                                                </button>
                                            </div>
                                            <!-- <div class="col-md-4 col-3 d-table p-0 m-auto">
                                                                        <div class=" d-table-cell text-right">
                                                                            <div class="dropdown">
                                                                                <button class="dropbtn">
                                                                                    <span class="fa fa-ellipsis-h"></span>
                                                                                </button>
                                                                                <div class="dropdown-content">
                                                                                    <a href="#">Edit</a>
                                                                                    <a href="#">Contact Us</a>
                                                                                    <a href="#">Settings</a>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div> -->
                                        </div>
                                        
                                        <!--<img src="img/john.jpg" class="user-img" alt=""/>
                                                                  <p>John Doe</p>-->
                                    </div>

                                    <!-- Record Ringless Voice Modal Start -->
                                    <div class="modal fade" id="recordRinglessVoiceMailModal" tabindex="-1" role="dialog" aria-hidden="true">
                                        <div class="modal-dialog modal-md" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Record Voice Mail</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <div id="controls">
                                                        <div class="row">
                                                            <div class="col-md-4 col-lg-4 col-sm-12 col-xs-12">
                                                                <button id="recordButton" class="btn btn-outline-success "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-record-btn" viewBox="0 0 16 16">
                                                                    <path d="M8 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                                                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                                                  </svg> Record</button>    
                                                            </div>
    
                                                            <div class="col-md-4 col-lg-4 col-sm-12 col-xs-12">
                                                                <button id="pauseButton" class="btn btn-outline-dark" disabled> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-btn" viewBox="0 0 16 16">
                                                                    <path d="M6.25 5C5.56 5 5 5.56 5 6.25v3.5a1.25 1.25 0 1 0 2.5 0v-3.5C7.5 5.56 6.94 5 6.25 5zm3.5 0c-.69 0-1.25.56-1.25 1.25v3.5a1.25 1.25 0 1 0 2.5 0v-3.5C11 5.56 10.44 5 9.75 5z"/>
                                                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                                                  </svg> Pause</button>
                                                            </div>
                                                            <div class="col-md-4 col-lg-4 col-sm-12 col-xs-12">
                                                                <button id="stopButton" class="btn btn-outline-danger" disabled> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop-btn" viewBox="0 0 16 16">
                                                                    <path d="M6.5 5A1.5 1.5 0 0 0 5 6.5v3A1.5 1.5 0 0 0 6.5 11h3A1.5 1.5 0 0 0 11 9.5v-3A1.5 1.5 0 0 0 9.5 5h-3z"/>
                                                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                                                  </svg> Stop</button>
                                                            </div>
                                                        </div>
                                                        
                                                        
                                                        
                                                        
                                                    </div>
                                                    <div id="formats"></div>
                                                    <!-- <h3>Recordings</h3> -->
                                                    <div id="recordingsList"></ol>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Record Ringless Voice Mail Modal End -->
                          <!-- Add Send Sms Modal -->
                    <!-- <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">SMS</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                        <form id="send_sms">
                          <div class="form-group">
                            <select class="form-control" id="sourceMsgNumber">
                              <option value="" selected>Select Source Number</option>
                              <option value="(425) 578-5798">(425) 578-5798</option>
                            </select>
                          </div>
                          <div class="form-group d-dflex">
                            <input type="tel" class="form-control" id="dest_num_sms" placeholder="Dest Number"  required/>
                          </div>
                          <div class="form-group">
                            <textarea class="form-control" id="message_body" rows="4" placeholder="Message" required></textarea>
                          </div>
                          <button type="submit"  class="btn btn-primary float-right">
                            Send
                          </button>
                        </form>
                                </div>
                            </div>
                        </div>
                    </div> -->
           
                      
                                    
                                
                                </div>
                                <div
                                    class="col-md-12 col-sm-12 col-lg-12 col-12 d-none d-lg-block contacts-box"
                                    id="contacts-box"
                                    >
                                    <div class="co-md-12">
                                        <div class="message-datatable">   
                                            <form method="post">         
                                            <table id="inboundCall" class="table table-striped table-bordered" style="width: 100%">
                                              <thead>
                                                <tr>
                                                  <th>Voice Mail Id</th>
                                                  <th>Voice Mail Name</th>
                                                  <th>Action </th>
                                                  </tr>
                                              </thead>
                                              <tbody id="inbound-data"></tbody>
                                            </table>
                                            </form>
                                            </div>
        
                                    </div>
        
                                </div>
                            </div>
                            
                        </div>
                       
                    </div>                           
                </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            </div>
        </div>

        <div class="modal" id="leadsModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-md role="document">
              <div class="modal-content">
                <!-- <div class="modal-header">
                  <h5 class="modal-title">Modal title</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div> -->
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="voiceMailLead">Select Lead</label>
                                <select class="form-control" id="voiceMailLead">
                                 <option value="">Select</option>
                                </select>
                              </div>

                        </div>

                    </div>
                  
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="sendVoiceMail">Send Ringless Voice Mail</button>
                  <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>


          <!-- <div id="removeVoiceMAilModal" class="modal">
            <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
            <form class="modal-content" action="/action_page.php">
              <div class="container">
                <h1>Delete Account</h1>
                <p>Are you sure you want to delete your account?</p>
          
                <div class="clearfix">
                  <button type="button" class="cancelbtn">Cancel</button>
                  <button type="button" class="deletebtn">Delete</button>
                </div>
              </div>
            </form>
          </div> -->
          <div id="removeVoiceMailModal" class="modal fade">
            <div class="modal-dialog modal-confirm">
                <div class="modal-content">
                    <!-- <div class="modal-header flex-column">
                        <div class="icon-box">
                            <i class="material-icons">&#xE5CD;</i>
                        </div>						
                        <h4 class="modal-title w-100">Are you sure?</h4>	
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div> -->
                    <div class="modal-body">
                        <div class="alert alert-danger">
                            <p>Do you really want to delete these records? This process cannot be undone.</p>
                        </div>
                           
                        
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="remove_voice_msgs_btn">Delete</button>
                    </div>
                </div>
            </div>
        </div> 
        

        <script>
            var passwordResetToken = getParam("token");
            var userToken = localStorage.getItem("user-token");

            console.log("MODE: PASSWORD_RESET, Token - " + passwordResetToken);

            if (userToken == null) {
                window.location.replace("student_login.html");
            }

            function getParam(sParam) {
                var sPageURL = window.location.search.substring(1);
                var sURLVariables = sPageURL.split("&");
                for (var i = 0; i < sURLVariables.length; i++) {
                    var sParameterName = sURLVariables[i].split("=");
                    if (sParameterName[0] == sParam) {
                        return sParameterName[1];
                    }
                }
            }
                                       
            $(document).ready(function () {
                $("#left-sidebar").load("sidebar.html");
                $("#page-header").load("header.html");
                //                        $("#page-container").load('dashboard.html');
            });
            $("#body-row .collapse").collapse("hide");

            // Collapse/Expand icon
            //$('#collapse-icon').addClass('fa-angle-double-left');
  
            // Collapse click
            function left_sidebar() {
                SidebarCollapse();
            }

            function SidebarCollapse() {
                $(".menu-collapsed").toggleClass("d-none");
                $(".sidebar-submenu").toggleClass("d-none");
                $(".submenu-icon").toggleClass("d-none");
                $("#sidebar-container").toggleClass(
                        "sidebar-expanded sidebar-collapsed"
                        );

                // Treating d-flex/d-none on separators with title
                var SeparatorTitle = $(".sidebar-separator-title");
                if (SeparatorTitle.hasClass("d-flex")) {
                    SeparatorTitle.removeClass("d-flex");
                } else {
                    SeparatorTitle.addClass("d-flex");
                }

                // Collapse/Expand icon
                //$('#collapse-icon').toggleClass('fa-angle-double-left fa-angle-double-right');
            }

            $(document).ready(function () {
        //     get_user_list(function (response) {
        //         $('#chat_user_loader').remove();
        //         for (var user of response){
                    
        //         $("#inbound-data").append(`<tr>
                                        
        //                                     <td class="single-contact row" id="${user.id}" onclick="open_chat(this, '${user.phone}', '${user.name}')">${user.name}</td>
        //                                     <td>${user.phone}</td>
                                        
        //                             </tr>`);
                
        //         }

        //         $("#inboundCall").DataTable({order:[]});
               
             
            
        
        // });
        // var xhr=new XMLHttpRequest();
        //       xhr.onload=function(e) {
        //           if(this.readyState === 4) {
        //               console.log("Server returned: ",e.target.responseText);
        //               var response = JSON.parse(e.target.responseText)
        //               console.log(response)
        //               if(response.message == "success")
        //               {
        //                 var html = "";
        //                 var VoiceMail_total = response.ringlessVoiceMails.lenth ; 
        //                 for (const element of response. ringlessVoiceMails) {
        //                    html += "<tr><td> "+ element.id  +" </td><td> " + element.voiceMail_name  +" </td> <td> <a class='btn btn-primary' href='javascript:;'> Send </a> <a class='btn btn-primary' href='javascript:;'> Delete </a></td></tr>";
        //                    $("#inbound-data").html(html);
        //                 }
        //               }
        //           }
        //       };
        //       xhr.open("GET","http://127.0.0.1:8000/getRinglessVoiceMail/",true);
        //       xhr.send();

        // var SERVER = "http://127.0.0.1:8000/";
        $('#loading-image').parent("div").css("display" , "block");
        $.ajax({
          url: SERVER + "ringlessVoiceMail_api/fetch/",
          async: true,
          crossDomain: true,
          crossOrigin: true,
          type: "GET",
          contentType : 'json',
          headers: { "Authorization": "Token "+`${localStorage.getItem('user-token')}` }
        }).done( (response) => {
            console.log(response)
            if(response.message == "success")
            {
                var html = "";
                for (const element of response. ringlessVoiceMails) {
                    html += "<tr><td> "+ element.id  +" </td><td> " + element.voiceMail_name  +" </td> <td> <a class='btn btn-primary fa fa-send send_voice_mail_btn' href='javascript:;' data-id="+element.id+"> Send </a> <a class='btn btn-danger fa fa-trash remove_voice_msgs' href='javascript:;' data-id="+element.id+"> Delete </a></td></tr>";
                    
                }
                $("#inbound-data").html(html);
                $('#loading-image').parent("div").css("display" , "none");
                
            }          
        }).fail( (err) => {
            swal({	
                title: "not fetching voicemail list.",	
                text: "somthing went wrong.",	
                icon: "error",	
                timer: 2000
                });	
            //  $('#send_sms').trigger("reset");
            console.log(err)
            $('#loading-image').parent("div").css("display" , "none");
        })
        
    
        });
            /*IF NOT SCROLLED SHOW SCROLL BUTTON*/ 
           

            /*SCROLL MESSAGE BOX TO BOTTOM*/
            function scroll_to_bottom() {
                var objDiv = document.getElementById("message-box");
                objDiv.scrollTop = objDiv.scrollHeight;
                scrollBtn.style.display = "none";
                if (maxScrollValue < objDiv.scrollTop)
                    maxScrollValue = objDiv.scrollTop;
            }
            scroll_to_bottom();



            
          
        </script>
         <script src="js/ringlessVoiceMail.js"></script>
    </body>
</html>
