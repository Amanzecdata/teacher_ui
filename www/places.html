<!DOCTYPE html>
<html lang="en">

    <head>
        <title>SF Social Service</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
              crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

        <!-- user.html JS, CSS start -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css">
        <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
        <!-- user.html JS, CSS end -->

        <link rel="stylesheet" href="css/dashboard.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <link rel="stylesheet" href="css/setting.css">
        <link rel="stylesheet" href="css/sms.css">
        <link rel="stylesheet" href="css/header.css">
        <link rel="stylesheet" href="css/administration.css">

        <script src="js/main.js"></script>
        <script src="js/web_api.js"></script>

        <style>
            .p-0 .container-fluid {
                padding-left: 0px !important;
                padding-right: 0px !important;
            }
        </style>



        <script>
            function myFunction() {
                var x = document.getElementById("myLinks");
                if (x.style.display === "block") {
                    x.style.display = "none";
                } else {
                    x.style.display = "block";
                }
            }
        </script>


    </head>

    <body>
        <div class="container-fluid p-0">

            <!-- Bootstrap row -->
            <div class="row" id="body-row">
                <div id="left-sidebar">

                </div>
                <div class="col p-0 content-div">
                    <div id="page-header">

                    </div>
                    <div class="container my-2">
                        <div id="placesListData">
                            <h2>
                                <b>Places</b>
                            </h2>
                            <div class="text-right mb-2">
                                <button onclick="add()" class="btn btn-primary btn-add">
                                    <i class="fa fa-plus"></i> Add Place
                                </button>
                            </div>
                            <div class="table-div">
                                <table id="placeTable" class="table table-striped table-bordered" style="width: 100%">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Address</th>
                                            <th>Phone</th>
                                            <th>Edit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="body-data"></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="showEditForm" style="display: none" class="pt-3">
                            <!-- <form id="placeForm">
                                 
                                </form> -->
                            <div>
                                <button onclick="goBack()" class="btn">
                                    <i class="fa fa-chevron-left"></i> Back
                                </button>
                                <button onclick="goBack()" class="btn btn-danger float-right" id="showDelete">
                                    <i class="fa fa-trash"></i> Delete
                                </button>
                            </div>
                            <h2 class="text-center">
                                <b id="placeTitle"></b>
                            </h2>
                            <form class="px-2">
                                <div class="form-group">
                                    <label for="title">Title</label>
                                    <input type="text" class="form-control" id="title" placeholder="Title" />
                                </div>

                                <div class="form-group">
                                    <label for="address">Addess</label>
                                    <input type="text" class="form-control" id="address" placeholder="Address" />
                                </div>

                                <div class="form-group">
                                    <label for="description">Description</label>
                                    <input type="text" class="form-control" id="description" placeholder="Description" />
                                </div>

                                <div class="form-group">
                                    <label for="phone">Phone</label>
                                    <input type="text" class="form-control" id="phone" placeholder="Phone" />
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="latitude">Latitude</label>
                                        <input type="text" class="form-control" id="latitude" placeholder="Latitude" />
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="longitude">Longitude</label>
                                        <input type="text" class="form-control" id="longitude" placeholder="Longitude" />
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Population List</label>
                                    <div id="populationList" class="form-group row m-0">
                                        <!-- <div class="form-check form-check-inline">
                                                      <input class="form-check-input" type="checkbox" id="gridCheck">
                                                      <label class="form-check-label" for="gridCheck">
                                                          Check me out
                                                      </label>
                                                  </div> -->
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Services</label>
                                    <div id="services" class="form-group row m-0"></div>
                                </div>
                                <div class="form-group">
                                    <label for="other">Other Information</label>
                                    <textarea class="form-control" id="other" rows="3"></textarea>
                                </div>
                                <button type="button" class="btn btn-primary">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                $("#left-sidebar").load('sidebar.html');
                $("#page-header").load('header.html');
                //                        $("#page-container").load('dashboard.html');

            });
            $('#body-row .collapse').collapse('hide');

            // Collapse/Expand icon
            //$('#collapse-icon').addClass('fa-angle-double-left');

            // Collapse click
           function left_sidebar() {
                SidebarCollapse();
            }

            function SidebarCollapse() {
                $('.menu-collapsed').toggleClass('d-none');
                $('.sidebar-submenu').toggleClass('d-none');
                $('.submenu-icon').toggleClass('d-none');
                $('#sidebar-container').toggleClass('sidebar-expanded sidebar-collapsed');

                // Treating d-flex/d-none on separators with title
                var SeparatorTitle = $('.sidebar-separator-title');
                if (SeparatorTitle.hasClass('d-flex')) {
                    SeparatorTitle.removeClass('d-flex');
                } else {
                    SeparatorTitle.addClass('d-flex');
                }

                // Collapse/Expand icon
                //$('#collapse-icon').toggleClass('fa-angle-double-left fa-angle-double-right');
            }
            var places = [];
            var services;
            $(document).ready(function () {
                list_services(function (place) {
                    console.log(place);
                    places = place.places;
                    services = {population_list: place.population_types, services_list: place.service_types};
                    place.places.forEach((item, i) => {
                        $("#body-data").append(`<tr>
                        <td>${item.title}</td>
                        <td>${item.address}</td>
                        <td>${item.phone}</td>
                        <td><button onclick="edit('${i}')" class="btn btn-primary btn-edit"><i class="fa fa-pencil-square-o"></i></button></td>
                        </tr>`);
                    });

                    $("#placeTable").DataTable();
                });
            });

            function goBack() {
                $("#placesListData").show();
                $("#showEditForm").hide();
            }

            function add() {
                $("#placesListData").hide();
                $("#showDelete").hide();
                $("#showEditForm").show();
                $("#placeTitle").text("Add Place");
                $("#address").val("");
                $("#title").val("");
                $("#description").val("");
                $("#latitude").val("");
                $("#longitude").val("");
                $("#phone").val("");
                $("#other").val("");

                getAllServices();
            }

            function edit(i) {
                console.log(places[i]);
                var edit = document.getElementById("showEditForm");
                var tableData = document.getElementById("placesListData");
                // if (edit.style.display === "none") {
                //     edit.style.display = "block";
                //     tableData.style.display = "none";
                // } else {
                //     edit.style.display = "none";
                //     tableData.style.display = "block";
                // }

                $("#placesListData").hide();
                $("#showEditForm").show();
                $("#showDelete").show();
                $("#placeTitle").text("Update Place");

                $("#address").val(places[i].address);
                $("#title").val(places[i].title);
                $("#description").val(places[i].description);
                $("#latitude").val(places[i].latitude);
                $("#longitude").val(places[i].longitude);
                $("#phone").val(places[i].phone);
                $("#other").val(places[i].other_info);


                getAllServices();

                places[i].population_list.forEach((populationItem) => {
                    $(`#${populationItem.replace(/[^A-Z0-9]/gi, '')}`).prop("checked", "checked");
                });

                places[i].services_list.forEach((serviceListItem) => {
                    $(`#${serviceListItem.replace(/[^A-Z0-9]/gi, '')}`).prop("checked", "checked");
                });
            }

            function getAllServices() {

                $("#populationList").empty();
                $("#services").empty();

                var populationItems = "";

                services.population_list.forEach((populationItem) => {
                    populationItems += `<div class="form-check form-check-inline col-md-2">
                            <input class="form-check-input" type="checkbox" id="${populationItem.replace(/[^A-Z0-9]/gi, '')}" value="${populationItem}">
                            <label class="form-check-label" for="${populationItem}">
                                ${populationItem}
                            </label>
                        </div>`;
                });

                $("#populationList").append(populationItems);

                var service = "";
                services.services_list.forEach((serviceListItem) => {
                    service += `<div class="form-check form-check-inline col-md-2">
                            <input class="form-check-input" type="checkbox" id="${serviceListItem.replace(/[^A-Z0-9]/gi, '')}" value="${serviceListItem}">
                            <label class="form-check-label" for="${serviceListItem}">
                                ${serviceListItem}
                            </label>
                        </div>`;
                });

                $("#services").append(service);
            }

        </script>